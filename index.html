<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Realidad Aumentada Web</title>
    <!-- Añadimos el favicon aquí -->
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">

    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
      #logo {
        position: fixed;
        top: 10px;
        left: 10px;
        max-width: 25%;
			  max-height: 25%;
        z-index: 1000;
      }
      #target-name {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-family: Arial, sans-serif;
        display: none;
        z-index: 999; /* Asegura que esté por encima del modelo 3D */
      }

      .mindar-ui-loading {
        flex-direction: column;
      }
      .loading-text {
        color: white;
        font-size: 24px;
        margin-bottom: 20px;
      }
      
      .mindar-ui-scanning .scanning .inner {
        position: relative;
      }
      
      .mindar-ui-scanning .scanning .inner .target-image {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-width: 85%;
        max-height: 85%;
        z-index: 0;
        opacity: 0.50;
      }
    
      .mindar-ui-scanning .scanning .inner .scanline,
      .mindar-ui-scanning .scanning .inner::before,
      .mindar-ui-scanning .scanning .inner::after {
        z-index: 2;
        position: relative;
      }
    </style>

  </head>
  <body>
    <img id="logo" src="images/logo.svg" alt="Logo">

    <div id="custom-loading-overlay" class="mindar-ui-overlay mindar-ui-loading">
      <div class="loading-text">Cargando...</div>
      <div class="loader"></div>
    </div>

    <div id="scanning-overlay" class="mindar-ui-overlay mindar-ui-scanning">
      <div class="mindar-ui-overlay mindar-ui-scanning">
        <div class="scanning">
          <div class="inner">
            <img src="images/target.jpg" alt="Target" class="target-image">
            <div class="scanline"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="target-name"></div>

    <a-scene
      mindar-image="maxTrack: 1; filterMinCF:0.0001; filterBeta: 0.001; imageTargetSrc: https://www.nexar.cl/demos/webar/assets/target/targets.mind; uiScanning: #scanning-overlay; uiLoading: #custom-loading-overlay;"
      xr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      loading-screen="enabled: false"
    >
      <a-assets>
        <a-asset-item
          id="model0"
          src="https://www.nexar.cl/demos/webar/assets/3d/1_VolcanLlaima.glb.glb"
        ></a-asset-item>
        <a-asset-item
          id="model1"
          src="https://www.nexar.cl/demos/webar/assets/3d/2_Araucaria.glb.glb"
        ></a-asset-item>
        <a-asset-item
          id="model2"
          src="https://www.nexar.cl/demos/webar/assets/3d/3_CarpinteroNegro.glb"
        ></a-asset-item>
        <a-asset-item
          id="model3"
          src="https://www.nexar.cl/demos/webar/assets/3d/4_MonitoDelMonte.glb"
        ></a-asset-item>
        <a-asset-item
          id="model4"
          src="https://www.nexar.cl/demos/webar/assets/3d/5_Puma.glb"
        ></a-asset-item>
        <a-asset-item
          id="model5"
          src="https://www.nexar.cl/demos/webar/assets/3d/6_Guina.glb"
        ></a-asset-item>
        <a-asset-item
          id="model6"
          src="https://www.nexar.cl/demos/webar/assets/3d/7_SaltoTrufulTruful.glb"
        ></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity id="target0" mindar-image-target="targetIndex: 0">
        <a-gltf-model
          rotation="-140 75 115"
          position="0.1 0.15 0"
          scale="0.75 0.75 0.75"
          src="#model0"
          animation-mixer
        >
        </a-gltf-model>
      </a-entity>
      <a-entity id="target1" mindar-image-target="targetIndex: 1">
        <a-gltf-model
          rotation="7 0 0"
          position="0 -0.7 0"
          scale="0.1 0.1 0.1"
          src="#model1"
          animation-mixer
        >
        </a-gltf-model>
      </a-entity>
      <a-entity id="target2" mindar-image-target="targetIndex: 2">
        <a-gltf-model
          rotation="-100 0 150"
          position="0.1 0 0"
          scale="0.7 0.7 0.7"
          src="#model2"
          animation-mixer
        >
        </a-gltf-model>
      </a-entity>
      <a-entity id="target3" mindar-image-target="targetIndex: 3">
        <a-gltf-model
          rotation="0 90 60"
          position="-0.1 0 0"
          scale="0.7 0.7 0.7"
          src="#model3"
          animation-mixer
        >
        </a-gltf-model>
      </a-entity>
      <a-entity id="target4" mindar-image-target="targetIndex: 4">
        <a-gltf-model
          rotation="55 60 60"
          position="-0.05 0.1 0"
          scale="1 1 1"
          src="#model4"
          animation-mixer
        >
        </a-gltf-model>
      </a-entity>
      <a-entity id="target5" mindar-image-target="targetIndex: 5">
        <a-gltf-model
          rotation="53 -68 -76"
          position="0.1 0.2 0"
          scale="2 2 2"
          src="#model5"
          animation-mixer
        >
        </a-gltf-model>
      </a-entity>
      <a-entity id="target6" mindar-image-target="targetIndex: 6">
        <a-gltf-model
          rotation="-80 195 160"
          position="-1 0.35 0"
          scale="0.04 0.04 0.04"
          src="#model6"
          animation-mixer
        >
        </a-gltf-model>
      </a-entity>
    </a-scene>

    <script>
      function adjustLogoSize() {
          const logo = document.getElementById('logo');
          if (window.innerWidth < window.innerHeight) {
            // Pantalla vertical
            logo.style.width = '25vw';
            logo.style.height = 'auto';
          } else {
            // Pantalla horizontal
            logo.style.width = 'auto';
            logo.style.height = '25vh';
          }
      }
  
      // Ajustar el tamaño del logo cuando se carga la página
      window.addEventListener('load', adjustLogoSize);
  
      // Ajustar el tamaño del logo cuando se redimensiona la ventana
      window.addEventListener('resize', adjustLogoSize);

      const targetNameElement = document.getElementById('target-name');
        const targets = {
            target0: "Parque Nacional Conguillío",
            target1: "Araucaria",
            target2: "Carpintero negro",
            target3: "Monito del monte",
            target4: "Puma",
            target5: "Güiña",
            target6: "Salto Truful Truful"
        };

        function showTargetName(name) {
            targetNameElement.textContent = name;
            targetNameElement.style.display = 'block';
        }

        function hideTargetName() {
            targetNameElement.style.display = 'none';
        }

        Object.keys(targets).forEach(targetId => {
            const target = document.getElementById(targetId);
            
            target.addEventListener("targetFound", event => {
                showTargetName(targets[targetId]);
            });

            target.addEventListener("targetLost", event => {
                hideTargetName();
            });
        });
    </script>

  </body>
</html>